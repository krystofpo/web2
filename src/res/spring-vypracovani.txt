Jirka napsal zadan iukolu na spring

Moej poznamky

Login – mam udelat i frontend? Nejaka prihlasovaci strnka?
Stranka vytovirt nebo hledani
Na strance hlednai, vysledky, zobrizt odkazy na edit.
Note – more than one labels, jak bude entita mit vic nez jedno jmeno?
Dva zaznamy s ruznymi id, dve riuzna jmena a dva stjene popisy?

Nebo  v db labels co ma cizi klic a ten ukazuje na 2 labely?

Jak mam vytvorit databzi?
Kde na jamym serveru? 
Dockery a pripojeni a ssh tunely? 


Budu to delat v idea, budu mit nejakou VCS? Kde? 

Kam se udela artefakt? Build? Deploy? 
Prihlaseni bezpecne? Jak ? 
Jak nakofgigurovat maven nebo gradle?
Jak pouzi liquibase? 
Jak se pracuje s jenkinsem? 


Neslo by to zjednodusit? Mene nastroju? 

Udelat si porjekt ve springu boot s jedduchym gradle scriptem. Je to v knizce?sprign boot?

Video co posilal jirka machart od joshua o spriungu

Dostla jsem zaskoleni od jirk ymacharta
GRADLE
Do gradle, jak se zacina porjekt, gradle wrapper, spring boot
Lze zacit jen se soubry gradel wrapper, to je bat soubora  a linux shell soubor,
A slozka ktera obshue jar a properties soubor. 
Proerties tma lez nastaig tjaou verzi gradlu chciu
Spusti se bat v command line a ta sthaen gradle z netu, da do slozky home (users/polanksyúgradle)
Asi prikaz gradlew init
A taky vytvori soubor gradle.properties.
Ten upraivm dam pryc komentare, vyhazu to co nechci.
A muzu otevrit IDE a otevrit soubor gradle.build a zacit na tom projekt.

Nebo jdu na start.spring.io a vygenruju si spring boot projekt a ten uz tohl ema nsatvaeny.
Kdyz je porjekt vcetne springboot, takma v gardle nastevno jako library spring boot
A kdyz se pak da buld pomoci grdlu, takse udela jenden jar soubor kterej obshauej v sobe i libs. 
Tkaez k jeho spusteni je treb ajen java, ani gradle, ani spring, ani IDE. 

Na spirg io je tutorial jak se dela projekt s gradlem ,to ted delam. Pak se podivam na porjekt se spring boot. 
Jirka kehar rikla ze postupne se bud uveci ucit, budou se nabalovat, ale zacit se da jednduse. 

Ctu navod na spriong io projektc  gradlem, delam buidl a udela to jarko ale to nejde spustit chybi tam mnaigfest.

Tak jsem pouzil gradlewrapper a ten mi stahnul novou verzi JVM nevim proc kdyz uz to mam, ale dobre.
¨
¨zkusim gradlew build

Nevim proc nestaci jenom gradle, abych udelal spustitelny jarko. Dodlůeat

Jel jsem podle navodu tutorial  spirng gradle project. Mam nainstalovanej gradle, clkeove. Taky by to slo bez gradlu, ze bych si stahl wrapper a on by stahnul gradle.ale mam gradle. 
Jdu do commnad line, dam gradle task, chybi tam build. Kdyz vvroim soubior build.gradle nebo gradle.build a napisu tam nejaky prikazy,  a dam znova gradle task tak mi to nabdien uz i build. 
Tak muzu udela jar,a le predtim musim do gradle.build souboru napsat applicaiton  a nastaivt tam main class. 
Kdyz se rucne nastavi gradle projekt tka to pak uz sezere idea. 

Co to je class path?
Mam si precist i ve spring knizce advanced wiring a taky spirng boot


Vypracovani:
Zacibnam

1.	Udelam si gradle rpojekt.
Jak na to: cmd, gradle init - -type java-application. Vytovir se vsechno. Vyhodit grdle porperties, smazu.
Upravim build.gradle, dam tam 
plugins {

        id 'org.springframework.boot' version '1.5.8.RELEASE'
        id 'java'

}  

Vyhdoiljsem main class name, to dela spring boot
2.	Pridal jsem tim  spring boot kvuli spustitlenym jar. 
Ano fugnuje spustitelny jar. Jeste jednduese zkusim gradle run v rootu. Aha tak gradle run neexistuje. Asi proottze jsem vyhodil mainclas name app. Ale je tu task bootrun, asi od spring bootu a to funguje. 
3.	Pridam spring. Oteveru v idea IDE  a pridam anotace spirngu. A spustim. Ted nepouzivam v kodu zdny spirg boot app tkaez se sposuti normalen main metoda. Nemusim resit azdny command line runnery atd. Prostr jenom napisu confugraci  a component scana  autowired a component atd  a vytvorim app context a gen tbean a pujde to. Zkusim pustit v IDEA a zkusim pustit v cmd.  Java jar. A gradle boot run. Ale kdyz budu pouzivt spirng knohvnu, tka ji musim pridat mezi dependecies ne? To se nikde nepise ve spring i action. A pritom mi fugoval yporjekty, ve kterych jsem si hral. Pocidvam se do ejjich build.gradle osoburu, trteba idea sama pridava do build.gradle dependecnies?aha tak v projektu, ktery jsem udelal se springem, to jsem si nechal vytvorit ideou a zadny gradle build tam neni, ale jsou tam knihovny sporingu, ale nevimkde jsou definovany. Asi se podivam na spring io tutorial starting a project with gradle. Nebo do kniozky spirng in acitn nepise se to v knize, ani ve spring v guidech, ale je to na sprigu v references, ke spring framework. https://projects.spring.io/spring-framework/
Prida se to to do gradle pomoci 
dependencies {
    compile 'org.springframework:spring-context:5.0.1.RELEASE'
}
A uz se muze delat confgi, cpmentscan, component atd
Pridal jsem to do buoidl .gradle a dal jsem si v idea gradle refesehs, v panelu nastorju grdle, stahlo mi to spring context a pridalo do classpath libs. A uz to muzu puzit. 

4.	Napsat spring config. Confuguraci udelam ve vlastni tride, aby se to nepletlo.  
udelal jsem novy balicek springConfig. V nem tridu SpringConfig. Nad tridu dam @Config. 
Nefunguje mi to. Exception apache log, class nto found. Fivne
Zkusim napsat test, tery vytvori context a v nem se udela uaotried. 
Mam tam @RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(classes=CDPlayerConfig.class)
public class TelevizeTest {
ale nejde mi resolve smybol spirngjuni4... a @context... proc? Kdyz mam v dpedencies rpign a sprignb oto?
Nasel jsem na stack overfloe ze potrebuju sprign boot test. 
Dam do     testCompile("org.springframework.boot:spring-boot-starter-test")
Ok uz se mi to naiportovlao
Napsal jsem test kde je autowired Televize a pusitl jsemto a vyjimka. 
java.lang.NoClassDefFoundError: org/apache/commons/logging/LogFactory

	at org.springframework.test.context.junit4.SpringJUnit4ClassRunner.<clinit>(SpringJUnit4ClassRunner.java:96)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at org.junit.internal.builders.AnnotatedBuilder.buildRunner(AnnotatedBuilder.java:104)
	at org.junit.internal.builders.AnnotatedBuilder.runnerForClass(AnnotatedBuilder.java:86)
	at org.junit.runners.model.RunnerBuilder.safeRunnerForClass(RunnerBuilder.java:59)
	at org.junit.internal.builders.AllDefaultPossibilitiesBuilder.runnerForClass(AllDefaultPossibilitiesBuilder.java:26)
	at org.junit.runners.model.RunnerBuilder.safeRunnerForClass(RunnerBuilder.java:59)
	at org.junit.internal.requests.ClassRequest.getRunner(ClassRequest.java:33)
	at org.junit.internal.requests.FilterRequest.getRunner(FilterRequest.java:36)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:49)
	at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:51)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
Caused by: java.lang.ClassNotFoundException: org.apache.commons.logging.LogFactory
	at java.net.URLClassLoader.findClass(URLClassLoader.java:381)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:335)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	... 16 more

Napad  - neni to tim, ze spirng boot vyzaduje vytovrieni spirng boot aplplicaiton a uiz nefunguje applcation context?

Zkusim vyhodit sprignb boot, ale zsast o nespustitm, z jarka. Tim padem to pustim pres gradle run, ale k tomu asi musim mit nastavene v build gradle poreprty class name

Zkusim pro cvik vytvorit gradle5 oznnova, abych si to tzopakvoal
Ano uz mam projekt se springem a autowire a funguje to, jeste to zkusim predelat,
Aby konfiguracni trid abyla samostatne, ve svym vlasntim balicku a component scan porhledaval vsechny dalsi balicky, resp top balicek ve kterym je jedn prazdna trida kvuli scanu, ano funguje. 

Ted jak do toho pridam spring boot?
Prectu si ve spirng in aciton, pak na spirng io, pak stackoverlwo atd, 
Nevim neresim, zacnu s spring web ze spring in action, vypiky jsou ve sprig vypisky


Otestovat vsechno, ve spocku, naucit se mockovat ve spocku

Ziskat od adma azdrojaky na ukzkovej porjekt, co mel na rest api a ajdbc



V porjektu web mam porjekt podle sping in action, mam tam spring mvc bey bootu, contorlery a mock repository.

Ted chci pridat sping data a to udelam ve spring bootu. 
Musi se naucit napred ciste sprog boot, ten uy obsahuje mvc. 
Takye napred udelam prjekt v esporign boot s mvc, udelam contorllery, 
Pak pridam spring data. A pak h2.
Musim se naucit mvc v bootu. Chapu, ye boot ma dve verze, command line runner a mvc. Podivm se do tutorialu. Boot. 
Zacnu manualne, udelam si gradle soubor a do nej pridam spring boot a otevru v idea. Pak si necham vzgenrovat spirug boot na start spring io.

Jak vytvorit gradle project ? zkusim task gradlew a ten snad vytvori gradle build soubor a adresarovou strukturu. Pak jen do buld.grdle dam dependencies a otevru v idee. 
Vztovirtl jsem adrear web2, pustil gradle tasks, pak pustil gradle init, udelalo to build.gradle soubor a do nej napsalo lugin java. Musim odkokentovat build.gradle. Ale neudella adresarvoou strukturu. Jakej task to udela?

Ok smayu vsechno v adreasri web2 a yacnu znova, gradle ma task init –java-app
Viz navod 
https://guides.gradle.org/building-java-applications/
ted se udelal build.gradle s jav aplugin a app lugin a udelala ase dreasrova sturktura. Otevru v idea
ted ctu v spirng boot navodu, instalace boot. Staci pridat do pluginu sriignb oot to ej gradle boot plugin, a kdzy pak pridvama do dependencies nejakz boot strtery, tka nemusim pridavat jejich verzi. Plugin taky s sebou tha dalsi dependency a umoynuje udelat jedno jarko a psusit ho pomoco boot run. \cili pridam do buidl gradle ppgihun gradle 
plugins {
    id 'org.springframework.boot' version '1.5.9.RELEASE'
    id 'java'
}
a do dependencies 

dependencies {
    compile("org.springframework.boot:spring-boot-starter-web")
    testCompile("org.springframework.boot:spring-boot-starter-test")
}

A dam pryc plugin applicatino, dam pryc define main class z gradle build. 

A pridam jar jar {
    baseName = 'myproject'
    version =  '0.0.1-SNAPSHOT'
}

Navod ale pocita s mavenem, takze jdu do guide sprign boot, tam je jinej buildgrdale soubor. 
buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:1.5.9.RELEASE")
    }
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'idea'
apply plugin: 'org.springframework.boot'

jar {
    baseName = 'gs-spring-boot'
    version =  '0.1.0'
}

repositories {
    mavenCentral()
}

sourceCompatibility = 1.8
targetCompatibility = 1.8

dependencies {
    // tag::jetty[]
    compile("org.springframework.boot:spring-boot-starter-web") {
        exclude module: "spring-boot-starter-tomcat"
    }
    compile("org.springframework.boot:spring-boot-starter-jetty")
    // end::jetty[]
    // tag::actuator[]
    compile("org.springframework.boot:spring-boot-starter-actuator")
    // end::actuator[]
    testCompile("junit:junit")
}

Nechapu sco je buidlscirpt cast a proc uz pototm v pluginu neni verze sprign gradle plugunu, ale porste to okpiruju

Tkahel vyapd amuj buid gradle
/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.1/userguide/tutorial_java_projects.html
 */



buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:1.5.9.RELEASE")
    }
}

apply plugin: 'java'
apply plugin: 'org.springframework.boot'



jar {
    baseName = 'my-proj-kry'
    version =  '0.1.0'
}

repositories {
    mavenCentral()
}

sourceCompatibility = 1.8
targetCompatibility = 1.8

dependencies {
   
    compile("org.springframework.boot:spring-boot-starter-web")


    testCompile("junit:junit")
}

Dal ale guide sprign boot m pirklad s command line runnerema to nechci, takze se vrcim do navodu docs sprign boot, tam maji mvc. 

Vztvoril jsem tridu obashujici main methodu a ta nacte poomoci spring boot aplicaiton run tuto tridu.

Pak v jine tride je antoce rest ocntroller a taky enable auto confuig. Nevim jestli to nejade beany

Ted se spsuti apiace tawsekem gradlu boot run. Zatim to nefuguje, ykuism dat enabel auto confuig nad hlavni tridus  s mainem. Anebo nad tu tridu dam spring bot aplivcioatn anotaci. 

Se nable auto config nad halvni tridou nic, mozna componenet scan se nedeje v celym balicku tak mu dam comnetnscan na vrchni blaicek aby nasel contorllet ale pomoci tridy, kteoru bosahuej vrchni balicek. Uy to fnugje. Staci enable auto confgi a nemusi byt ani spibn tboot apllicaitn antoace. A jede to, v browseru posutim /records/123  a vraci to obejkt json Note. parada

Fungovalo by java –jar na tuhel aplikaci? Nebo funguje jenom gradle bootrun? Ano
Ctu https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#getting-started
A zaroven https://spring.io/guides/gs/spring-boot/

. That’s because @RestController combines @Controller and @ResponseBody, two annotations that results in web requests returning data rather than a view. Proto mi v porhliyezi se zobrazi primo json a ne view s modelem

Pridam testy viz navod guide sporign boot, 
Pak s podivam na guige mvc abych udella lesi view nez jen json, ale mozna thymeleaf? Abch mohl udela thtml strnaku s odkazem a do ktery budu moct pridavat objkety sndno.
Pak si prectu spring data a pridam h2 a bude hotoov. 


---novy porjekt web2, mam na to github reposriotry
Mam tam spirng boot starter web a boot starter test psutim test na controller a hlasi mi to chybu
Unable to find a @SpringBootConfiguration, you need to use @ContextConfiguration or @SpringBootTest(classes=...) a pritom main meoda je onyacena springoot aplicaiton ale je v nejakym balicku a ten neni root. 
Podle me je lepsi dat main tridu a start app do sveho blaicku, ale byla by s tim prace navic, psani anotaci aby to naslo tridu se stpringboot app, tkaey ji dma do hornho blaicku. Na dma platform to je taky tak.
Predelal jsem ot, pusitm test a zas to hasli chybuy. Jdu cist znova sping boot guide

Ctu guide na testing web. Musi byt v depoednecy starter test. 
Napred otestuju jestli se nacita spirng boot context. Cili udelam tst tridy, ktera obsahuje main.
Ten test bude mit anotaci @RunWith(SpringRunner.class)
@SpringBootTest

Z nejakyho duvodu nefuguje  kdyz dam jenom @webmvc test  a runwth , ale funguje mi @RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class NoteControllerTest {
tkaye to tak necham. 

Mam test na noteocntorller. Ok ale ted mchci testu podsoupnout mock repository, aby to byl unit tst, testovat njenom cotnroler. Jak?
O udella jsem poomoci mockbean  a mam tam uz meyivrstvu mezi contorler a data. To je trida ktera dela logiku, bere data z db, yurpacuje je podle business logikz a preda je contorlleru. Contorller jen osetruje http requesty a zavola bussi nes logku a yiska data, pred aje view. 
Ctu spring guide data
Opridam depndcedencz na h2 a jpa data

Napsal jsem repository oddedenou od crudrepossitorz a napsal testy. Pouyiva to h2 dtbazi, staci mit v depodency a funguje to. Samo bez configurace. 

Jak nastavit spojeni s db h2?
Jak nastavit do jake tabulky se yapisuji entity?

Jak nsatavit poriamrz a foreign key?
Jak roydelit do dvou tabulek labely a note? Orm?
Da se ulozit h2 db do souboru?
Vztvorir init script ktery naplni db entitama

https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/#howto-database-initialization

osetreni chyb s db?
Vytvoreni tbaulkeka a cosntrainsitu?
https://docs.spring.io/spring-data/jpa/docs/2.0.2.RELEASE/reference/html/
ted se mi uklada entita sama do h2, stci dt save, zadna incializace db se nemusi delat dela to samo spring data jpa. Ted chci aby mohlo byt vic labelu na poznamku, cili asi list labelu, ale aby v db byla zvlast tabulka labels, natavit foreign key. A one to many? ORM?
Budu k tomu cist refrenci spirng jpa data
Repository to je rozisreno na crud rpeositor to je rozisreno na jpa repostiory

pisou, ze
Set up Spring to create proxy instances for those interfaces. Either via JavaConfig:

import org.springframework.data.jpa.repository.config.EnableJpaRepositories;

@EnableJpaRepositories
class Config {}

to nemam nikde v projektu, ale asi to dela sam spring boot kdyz ma v depncdepcncies sprig data jpa?





nechau otpional nejde mi to, kdzy oddesim crud nebo jparepositorz nebo repositorz
tak mi nejde pridat metoda s navratovzm tzpem optional


dsl language v jave to je vyhoda


Predicate predicate = user.firstname.equalsIgnoreCase("dave")
	.and(user.lastname.startsWithIgnoreCase("mathews"));

userRepository.findAll(predicate);




napred si aktvuju abych videl do h2 databaze,
zkuism dat do applicaiton porerties tohle
spring.h2.console.enabled=true
musim dat do src/main/resources/application.propersties
souboru
vyborne, kdyyz dam do firefoxu localhost:8080/h2/console
tak to funguje, otevrelj sem stranku ktera by mela vyvtorit zannam v
tabulce a otevrel jsem h2 db, ale nevim kde hledat svoje
data

pro9blem je ze neznam jdbc url kam se mam pripojit
consoel se pripoji kamkoliv i kdyz jdbc url je sptana

jaka je srpvna?

localhost:8080/h2/console
JDBC URL: jdbc:h2:mem:testdb
User Name: sa
Pasword: <leave this empty>

uz to funguje

jak udelat foreign key? schema.

mozna to budu muset udelat manualne, ale zkusim vytvorit
java entitu ktera bude mit jako atribut
list labelu, schvalne jestli se stim jpa popere samo?

muzu si s tim hrat sam anebo najit na webu
list<string> entity jpa sprig data

http://javasampleapproach.com/spring-framework/spring-boot/integrate-h2-database-springboot-spring-jpa-embedded-mode
peknej navod, h2 uklada do souboru takze data zustavaji
ale nema tam list

dobrej uvod do relacnich db a jpa
http://www.springboottutorial.com/introduction-to-jpa-with-spring-boot-data-jpa

many to many je tam ukazano, ale neni to vysvetleno
hledam ydroj kde by to bylo do hjloubky
anotace join table, cascade, mapped by atd
neco zakaldniho je zde

https://en.wikibooks.org/wiki/Java_Persistence/ManyToMany


many to many vyzaduje vytvorit join table kde jsou kombinace
obou klicu y obou entit

vyresit object ocrruption. kdzy se prida nebo odebere
na jedne entite tak se musi udelat spravna
akce na druhe entite, to se neudela asi samo.

jak? wiki jpa object cvorruption


musi se udelat jointable, ktera ma dva sloupce
jeden je foreign key ktery ukazuje na primary key
entity 1 a druhy sloupec je foriegn key
ktery ukazuje na primary key entititz2.
priamr key teto join tabukly je potom kombinace obou
sloupcu.

many to many je obousmerny v db, ale ne v jave.
aby to bylo obousmerne, musi jedna strana byt
owner, tzn ze entita ma anotaci join table
a
durha ma anotaci mapped by.





dobre zdroje:

http://www.springboottutorial.com/introduction-to-jpa-with-spring-boot-data-jpa


dobre:
https://www.callicoder.com/hibernate-spring-boot-jpa-many-to-many-mapping-example/

https://docs.oracle.com/javaee/5/api/javax/persistence/ManyToMany.html

tohle je dobre
https://en.wikibooks.org/wiki/Java_Persistence/ManyToMany

https://docs.oracle.com/javaee/6/api/javax/persistence/ManyToMany.html

http://www.objectdb.com/api/java/jpa

http://www.oracle.com/technetwork/java/javaee/tech/persistence-jsp-140049.html

i s testem, jak se to pouziva:
https://hellokoding.com/jpa-one-to-many-relationship-mapping-example-with-spring-boot-maven-and-mysql/


many to many relations hip
anebo one to many jedna poznamka muze mit vice labelu

napr pozn 1, labelA labelB
pozn 2, labelA, labelC

a najdu poznamky, ktere obsahuji labelA, vrati to pozn 1 a 2

test noterepositroty
problem kdyz mi vrati repository Notes, tak je nemuzu porovnat s poznamkama co jsem tam
ulozil prootye note ma equals jenom pmoco atributu note a ne set of labels,
takze kdyz se vrati bez labelu, test projde. musim but zmenit equals
nebo v tesut naspat noovu metodu na porovnani
equals builders co to je?
varianta v tesu metodu

nefunujge metod adelte all nevim proc nul pinter pritom je v mym repositorz